<?php

use Drupal\Core\Block\BlockPluginInterface;
use Drupal\taxonomy\Entity\Term;

/**
 * @file:
 *   Contains the module file for the inline_entity_form_preview module.
 */

/**
 * Implements hook_help().
 */
function inline_entity_form_preview_help($route_name, \Drupal\Core\Routing\RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the inline_entity_form_preview module.
    case 'help.page.inline_entity_form_preview':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Provides a preview column to display referenced entities directly.') . '</p>';
      return $output;

    default:
  }
}

/**
 * Implements hook_page_attachments().
 *
 * Attach the body-class-from-url library on every page so JS can add a
 * page-derived class to the document body.
 */
function inline_entity_form_preview_page_attachments(array &$attachments) {
  $attachments['#attached']['library'][] = 'inline_entity_form_preview/body_class_from_url';
}



/**
 * Implements hook_block_view_alter().
 */
function inline_entity_form_preview_block_view_alter(array &$build, BlockPluginInterface $block) {

  // Target ONLY your Views block.
  if ($block->getPluginId() !== 'views_block:latest_article_sidebar-block_1') {
    return;
  }

  // Get taxonomy term from route.
  $term = \Drupal::routeMatch()->getParameter('taxonomy_term');

  if ($term instanceof Term) {

    $title = t('Senaste @term', [
      '@term' => $term->label(),
    ]);

    // âœ… Correct way for Views blocks
    $build['#configuration']['label'] = $title;
    $build['#configuration']['label_display'] = TRUE;

    // Cache correctness.
    $build['#cache']['contexts'][] = 'route';
    $build['#cache']['tags'] = array_merge(
      $build['#cache']['tags'] ?? [],
      $term->getCacheTags()
    );
  }
}